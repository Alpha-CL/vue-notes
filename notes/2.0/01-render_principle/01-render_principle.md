# render principle

#### response principle

``` javascript
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


                                  + ------------------> +
                                  |                     |
        + -- 1.create instance -- + -------- +          |           1.创建 vue 实例( this 始终指向 实例 )                        
        |                         |          |          |
        |        vm <= new Vue(config);      |          |       
        |         |    |              |      |          |
        |         |    + --- this --- +      |          |
        |         |            |             |          |
        |         + <--------- +             |          |
        |                                    |          |
        + ---------------------------------- +          |                     
                           |                            |
                          \|/                           |
    + -- 2.inject --------------------------------- +   |           2.根据配置对象注入数据
    |                                               |   |
    |   config: { prop, method, event ... } <------ + - +
    |                                               |
    + --------------------------------------------- +
                           | 
                           | 
                          \|/
    + -- 3.first render --------------------------- +               3.首次渲染
    |                                               |                   - 3.1 根据 template 编译并创建 虚拟dom树
    |                                               |                         ( 本质为对象 )
    |   + ------------------------------------- +   |                   - 3.2 根据 虚拟dom树 的结构，创建 真实dom
    |   |                                       |   |                   - 3.3 将 真实dom 挂载到指定 dom节点 上
    |   |   compile and create virtual-dom      |   |                         ( 真实dom 有且仅有一个根节点 )
    |   |                                       |   |
    |   + ------------------------------------- +   |
    |                      |                        |
    |                      |                        |
    |                     \|/                       |
    |   + ------------------------------------- +   |
    |   |                                       |   |
    |   |   mount rdom about vdom on vm.$el     |   |
    |   |                                       |   |
    |   + ------------------------------------- +   |
    |                                               |
    |                                               |
    + --------------------------------------------- +
                           | 
                           | 
                          \|/
    + -- 4.mounted rdom on vm.$el ----- +                           + -- 5.re-render ---------------------- +
    |                                   |        data change        |                                       |
    |   1.data is mounted               |        response           |   1.rebuild vdom                      |
    |                                   | - - - - - - - - - - - - > |                                       |
    |   2.watch data and event          |                           |   2.diff new-vdom and old-vdom        |
    |                                   |                           |                                       |
    |   3. ...                          | <------------------------ |   3.re-render diff vdom               |
    |                                   |     re-render complete    |                                       |
    |                                   |                           |                                       |
    + --------------------------------- +                           + ------------------------------------- +


    4.已将 真实dom 挂载至 指定 真实dom节点        ---> 数据改变 --->      5.重新渲染
        - 监听数据变化                             触发响应式              - 创新新的 虚拟dom
        - 监听事件                                                       - 对比 新创建的虚拟dom 和 原来的虚拟dom 的差异
        - ...                                                            ( 本质上为对比对象 )
                                                                        - 根据虚拟dom对比的差异，找到真实dom
                                                                          重新渲染数据及结构
                                                                          ( 就近复用原则，降低 创建真实dom 的成本 )


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
```

#### infusion

``` javascript
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


/**
 * 根据创建 new Vue(comfigObj); 传入的 comfigObj 注入数据
 * 
 * 
 * 
 */

        + ----- create Vue -------- +           + ----- vm instance ------- +
        |                           |           |                           |
        |   new Vue({               |           |   vm <= new Vue(config);  |
        |                           |           |                           |
        |       el: '#app',         |           |   + --- $[member] --- +   |   $[memeber]: 可供开发者调用的方法及属性
        |                           |           |   |                   |   |
        |                           |           |   |   $attrs          |   |
        |                           |           |   |   $children       |   |
        |   + ----------------- +   |           |   |   ...             |   |  
        |   |                   |   |           |   |                   |   |
        |   |   data: {         |   |           |   + ----------------- +   |
        |   |       ...         |   |           |                           |
        |   |   },              |   |           |   + ---- [member] --- +   |   [member]: 从 config 中注入的数据
        |   |                   |   |           |   |                   |   |
        |   |   couputed: {     |   | infusion  |   |   {...data}       |   |
        |   |       ...         | ----------------> |   {...couputed}   |   |
        |   |   },              | ----------------> |   {...methods}    |   |
        |   |                   |   | infusion  |   |   ...             |   |
        |   |   methods: {      |   |           |   |                   |   |
        |   |       ...         |   |           |   + ----------------- +   |
        |   |   }               |   |           |                           |
        |   |   ...             |   |           |   + --- _[member] --- +   |   _[member]: 仅供 vue 使用的内部方法及属性
        |   |                   |   |           |   |                   |   |
        |   + ----------------- +   |           |   |   _data           |   |
        |                           |           |   |   _events         |   |
        |                           |           |   |   ...             |   |
        |                           |           |   |                   |   |
        |   });                     |           |   + ----------------- +   |
        |                           |           |                           |
        + ------------------------- +           + ------------------------- +


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
```

#### get template

``` javascript
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


/**
 * 1.vue 会根据 '模版' 创建 '虚拟节点树'
 * 2.再根据 '虚拟节点树'，创建 '真实的dom树'
 * 
 * 
 * 模版渲染权重: render() > config.template > vue-statement
 *
 ** vueTemplate 有且仅有一个 '根节点'
 */


vue 通过建立一个虚拟 dom 来监听如何改变真实 dom


//- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -//


1) render(h => h());          // defualt


/**
 * h(tagname: string | object | function, attrobutes: object, children: string | array): vdom: object;
 * 
 * 
 * hyperscript( 第三方库: 利用 js 创建 '超文本HyperText' )
 * 
 * @tagename: 标签名
 * @attrobutes: 属性对象
 * @children: 子节点
 * 
 * vdom: 虚拟dom
 */


( 详细api需查阅官方文档 )


//- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -//


2) config.template


const vm = new Vue({

    ...

    template: '
      <div>[config.template 权重第二]</div>
    ',
    
    ...
});


//- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -//


3) vue-statement


<div>{{varibale | experss | statement}}</div>


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
```

#### use template create flow about virtual-node-tree 

``` javascript
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


/**
 * 使用模板创建有关虚拟节点树的流程
 * 
 * 
 ** vue 创建 虚拟节点树 的本质最终还是会调用 render();
 */

render(dom, props: object, children: array);


//-------------------------------------------------------------------------------------------------------------------//


<div id="app"></app>


const vm = new Vue({

    el: '#app',
    
    template: '',
    
    render(h => {
    
        return h();
    })
})


//- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -//


    + --- 1.render() -- +           + -- 2.template --- +           + -- 3.el.outHtml - +
    |                   |           |                   |           |                   |
    |                 false ------> |                 false ------> |                   |
    |                   |           |                   |           |                   |
    + ----- true ------ +           + ----- true ------ +           + ----- true ------ +
              |                               |                               |
              |                               |                               |
    + ------------------- +                   |                               |
    |                     |                   |                               |
    |  virtual-node-tree  | <---------------- + ----------------------------- +
    |                     |
    + ------------------- +


    // 模拟 渲染模版 逻辑流程
        
    function createVnodeTree() {
    
        let _template;
    
        if ( ![render()] ) {                // 1. 判断是否没有 render();
    
            if ( [template] ) {
        
                _template = template;       // 2. 将 tenplate 作为模版
        
            } else {
            
                _template = el.outerHtml;   // 3. 将 el.outerHtml 作为模版
            }
        }
        
        return render(_template);           // vue 创建 虚拟节点树 的本质最终还是会调用 render();
    }


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
```

#### compile and render of template

``` javascript
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


                                1. 根据 '模版' 编译 '虚拟节点树'
                                
                                2. 再根据 '虚拟节点树' 创建 '真实dom树'
                                
                                3. 将 '真实dom树' 挂载到指定 '真实节点'


                                + ------------------ render ------------------- +
                                |                                               |
                                |                                               |
                                |        vnode tree          dom tree           |
                                |       + ------- +         + ------- +         |
                                |       |         |         |         |         |
    + --- template ---- +       |       |         |         |         |         |
    |                   |    compile    |         | create  |         |         |
    |                   | ============> |         | ======> |         |         |
    |                   |       |       |         |         |         |         |
    + ----------------- +       |       |         |         |         |         |
                                |       |         |         |         |         |
                                |       |         |         |         |         |
                                |       + ------- +         + ------- +         |
                                |                                               |
                                |                                               |
                                + --------------------------------------------- +


//- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -//


                                1. 数据发生变化
                                
                                2. 创建 '新的虚拟节点树'，与 '之前的虚拟节点树' 对比
                                
                                3. 根据对比出来的结果，仅 重新渲染 真实dom中的 差异部分( 节约资源开销 )
                                   ( 注意: 就近复用原则 )


                                + -------------------------- render --------------------------- +
                                |                                                               |
                                |                                                               |
                                |      old vnode tree      new vnode tree         dom tree      |
                                |       + ------- +         + ------- +         + ------- +     |
                                |       |         |         |         |         |         |     |
    + --- template ---- +       |       |         |         |         |         |         |     |
    |                   |    compile    |         |  diff   |         | create  |         |     |
    |                   | ============> |         | ------> |         | ======> |         |     |
    |                   |       |       |         | <------ |         |         |         |     |
    + ----------------- +       |       |         |         |         |         |         |     |
                                |       |         |         |         |         |         |     |
                                |       |         |         |         |         |         |     |
                                |       + ------- +         + ------- +         + ------- +     |
                                |                                                               |
                                |                                                               |
                                + ------------------------------------------------------------- +

                         
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
```

#### mount real-node-tree

``` javascript
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


/**
 * 将渲染出的 真实dom树 挂载到页面的指定 真实节点中
 * 
 * 
 * 
 */


//- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -//


1) 通过创建 new Vue(); 时指定挂载节点

const vm = new Vue({

    el: '#app'
});


//- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -//


2) 通过 vue实例 挂载

const vm = new Vue();

vm.$mount = '#app';


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
```