# mock

## untiles api

### axios

#### basic api

``` javascript
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


/**
 * axios(options: object): Promise;
 * 
 * 
 * options: {
 * 
 *      @method: 
 *      @url: 
 *      @data: 
 * }
 * 
 *
 * return: Promise
 */


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
```

#### advance api

``` javascript
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


/**
 * 
 * 
 * 
 * 
 */


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
```

#### interceptors

``` javascript
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


/**
 * interceptors
 * 
 * 
 * 
 */


axios.interceptor.request(resp => resp);

axios.interceptor.response(res= => resp);


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
```

### mockjs

#### base

``` javascript
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


/**
 * mock(rutl?: string, rtype?: string, template: object | function(options));
 * 
 * 
 * @rutl: 表示需要拦截的URL
 * 
 * @rtype: 表示需要拦截的Ajax请求类型( lower-upper-case )
 *  
 * @template: 表示数据模板
 * @function(options): 表示用于生成响应数据的函数
 */


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
```

## usage steps

``` javascript
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


// default response object of server


{
    code: 0,                // status
    msg: '',                // message
    data: [],               // data
}


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
```

### step_01: intercept data

#### 1.1: create vue-cli config file

``` javascript
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


/**
 * vue3.0+  webpack.config.js 不对外暴露，需创建 vue.config.js
 * 
 * 
 * 
 */


// commonjs module syntax

mkdir vue.config.js                 // vue-cli 的配置文件 === webpack.config.js


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
```

#### 1.2: config devServer.proxy

``` javascript
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


// vue.config.js === webapck.config.js


module.exports = {

    devServer: {
    
        port: '8081',
        
        proxy: {
        
            '/api': {
            
                target: string,                 // 服务器地址
                
                ws: boolean,                    // 是否代理 websockets
                
                changeOrigin: boolean,          // 是否允许跨域
                
                pathRewrite: {      
                
                    // match-string: regexp: replace-string: string;
                    // 根据正则匹配 target 中字符串，并替换为指定字符串
                    
                    '^api': '/',
                }
            }
            
            ... ...                             // 可配置多个代理规则
        }
    }
};


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
```

### step_02: simulation data

#### 2.1: create mock project directory

``` javascript
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


// mock tree


./project
|
|
|- api
|   |
|   |- request.js               // 封装拦截器处理错误
|   |
|   |- temp.js                  // 封装数据请求
| 
| 
|- mock
|   |
|   |- index.js                 // 模拟数据请求延迟
|   |                           // import "./temp";
|   |
|   |- temp.js                  // 数据模版
|   |
|
|
|- ... ...
|
|- main.js                      // import "./mock";
|
|- vue.config.js                // 配置代理
|
|


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
```

#### 2.2: config proxy in vue.config.js

``` javascript
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


// 添加代理规则

module.exports = {
	devServer: {
		proxy: {
		
		    // 代理规则 
            "[path]": {
            
                target: "[url]"
            },

		}
	}
};


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
```

#### 2.3: mock interceptors

``` javascript
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


// 利用拦截器，集中处理错误

axiosIns.interceptors.response.use(function(resp) {

	if (resp.data.code !== 0) {

        // 处理错误

		return null
	}

	return resp.data.data;
});


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
```

#### 2.4: mock temp & request data methods

``` javascript
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


/**
 * 封装
 * 
 * 
 * 1) 数据模版 
 * 
 * 2）请求数据的方法
 */


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
```

#### 2.5: injection

``` javascript
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


1) 在 /mock/index.js 中引入其他数据模版

    import "./temp_01";
    import "./temp_02";
    import "./temp_03";


2) 在 main.js 中引入 /mock/index.js 形成依赖关系

    import  "./mock";


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
```


#### 2.5: getTempData

``` javascript
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


// 调用封装好的数据请求方法即可


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
```